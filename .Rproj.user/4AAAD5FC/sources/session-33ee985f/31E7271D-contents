
# Load data ----

raw_data <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2021/2021-12-21/starbucks.csv',
                            show_col_types = FALSE)


# Clean up data for my purposes ----

starbucks <- raw_data |>
  mutate(category = case_when(str_detect(product_name, 
                                         "Chai|Tea|tea") ~ "Tea",
                              str_detect(product_name,
                                         "Lemonade|Smoothie|Hot Chocolate|Fibre Powder|Refresher|Apple Spice|CrÃ¨me Frappuccino Blended") ~ "Other",
                              TRUE ~ "Coffee" ), .before = product_name
  ) |> 
  mutate(product_name = str_to_title(product_name)) |> 
  mutate(size = str_to_title(size)) |>
  mutate(whip = case_when(whip == 0 ~ "No", 
                          whip == 1 ~ "Yes"),
         milk = case_when(milk == 0 ~ "None",
                          milk == 1 ~ "Nonfat",
                          milk == 2 ~ "2%",
                          milk == 3 ~ "Soy",
                          milk == 4 ~ "Coconut",
                          milk == 5 ~ "Whole")
  ) |> 
  select(-c(serv_size_m_l, saturated_fat_g, trans_fat_g, sodium_mg, total_carbs_g, fiber_g)) |>
  mutate(ID = row_number(), .before = category) |> # ensure unique ID for {ggiraph}
  rename(Category = category, 
         Drink = product_name,
         Size = size,
         Calories = calories,
         `Milk Type` = milk,
         `Whipped Topping` = whip,
         `Total Fat (g)` = total_fat_g,
         `Cholesterol (mg)` = cholesterol_mg,
         `Sugar (g)` = sugar_g,
         `Caffeine (mg)` = caffeine_mg)


# Write instructions for help page ----

# Why are bubbles turning red as I'm exploring the chart?
#   When you click on a bubble, it turns red. Click on the same bubble again to return the bubble to its original color.
# 
# How do I remove just one filter option instead of resetting all of them?
#   Click on the option that you want to remove so that it is highlighted. Select "Delete" on your keyboard.
# 
# How did you come up with the color scheme?
#   The Bootswatch minty color scheme available through {bslib} was used to style the app. The bubble chart color scheme was created using Gramazio, Laidlaw, and Schloss' [Colorgorical](http://vrl.cs.brown.edu/color). They wrote a [paper](http://vrl.cs.brown.edu/color/pdf/colorgorical.pdf?v=5dd92af6d1e6c5584236275adc769e82) about it for *IEEE Transactions on Visualization and Computer Graphics* in 2017.
# 
# How did you make the app?
#   See the code on [GitHub](https://github.com/toylyol/shiny-drinks-app)!
#   
# Where did you get this nutrition information?
#   The data are from Starbucks by way of the [TidyTuesday repo](https://github.com/rfordatascience/tidytuesday/blob/master/data/2021/2021-12-21/readme.md).
# 
# I want to zoom in a specific part of the chart. Is that possible?
#   When you hover over the chart, a menu appears at the top. Use the second icon from the left (a maginifying glass with a rectangle in the middle) to activate the zoom feature. Once it is activated, click and drag over the part of the chart where you want to zoom in.
# 
# Oh no, I zoomed in the chart way too far!
#   Don't worry: You can reset the chart. Use the icon that looks like four arrows pointing outward toward four corners.
# 
# Can I download the chart?
#  Click on the download arrow icon on the far-right to save a copy of the chart as it appears on your screen.
#
# Can I make the table columns wider?
#   Absolutely, hover over the column header you want to move until a symbol that looks like parallel lines with arrows pointing in opposite directions appears Click and drag the column header until it wide enough for you.
